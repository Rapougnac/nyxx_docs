"use strict";(self.webpackChunknyxx_docs=self.webpackChunknyxx_docs||[]).push([[825],{9613:function(e,t,n){n.d(t,{Zo:function(){return h},kt:function(){return d}});var a=n(9496);function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){c(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,c=function(e,t){if(null==e)return{};var n,a,c={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(c[n]=e[n]);return c}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(c[n]=e[n])}return c}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},h=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,c=e.mdxType,o=e.originalType,l=e.parentName,h=i(e,["components","mdxType","originalType","parentName"]),u=s(n),d=c,y=u["".concat(l,".").concat(d)]||u[d]||p[d]||o;return n?a.createElement(y,r(r({ref:t},h),{},{components:n})):a.createElement(y,r({ref:t},h))}));function d(e,t){var n=arguments,c=t&&t.mdxType;if("string"==typeof e||c){var o=n.length,r=new Array(o);r[0]=u;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:c,r[1]=i;for(var s=2;s<o;s++)r[s]=n[s];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6447:function(e,t,n){n.r(t),n.d(t,{assets:function(){return h},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return i},metadata:function(){return s},toc:function(){return p}});var a=n(2182),c=n(9028),o=(n(9496),n(9613)),r=["components"],i={title:"Cache",author:"l7ssha",timestamp:new Date("2021-09-21T00:00:00.000Z"),category:"guides",sidebar_position:2},l=void 0,s={unversionedId:"guides/cache",id:"guides/cache",title:"Cache",description:"Caching in nyxx is managed automatically with internal wrappers around existing Dart features. Nyxx features a",source:"@site/docs/guides/cache.md",sourceDirName:"guides",slug:"/guides/cache",permalink:"/nyxx_docs/docs/guides/cache",editUrl:"https://github.com/Rapougnac/nyxx_docs/tree/docusaurus/docs/guides/cache.md",tags:[],version:"current",lastUpdatedBy:"Rapougnac",lastUpdatedAt:1650733325,formattedLastUpdatedAt:"4/23/2022",sidebarPosition:2,frontMatter:{title:"Cache",author:"l7ssha",timestamp:"2021-09-21T00:00:00.000Z",category:"guides",sidebar_position:2},sidebar:"guideSidebar",previous:{title:"Writing your first bot",permalink:"/nyxx_docs/docs/guides/writing_your_first_bot"},next:{title:"Migration to nyxx_* 3.x",permalink:"/nyxx_docs/docs/guides/migration"}},h={},p=[{value:"CachePolicyLocation",id:"cachepolicylocation",level:4},{value:"CachePolicy",id:"cachepolicy",level:4}],u={toc:p};function d(e){var t=e.components,n=(0,c.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"Caching in nyxx is managed automatically with internal wrappers around existing Dart features. Nyxx features a\n",(0,o.kt)("a",{parentName:"p",href:"https://pub.dev/documentation/nyxx/latest/nyxx/ICache-class.html"},(0,o.kt)("inlineCode",{parentName:"a"},"ICache<T, S>"))," interface which is the base class for all caches used in the library.\nLike any other aspect of nyxx, cache handling can be altered to fit your needs."),(0,o.kt)("p",null,"You can pass an instance of ",(0,o.kt)("inlineCode",{parentName:"p"},"CacheOptions")," when creating your ",(0,o.kt)("inlineCode",{parentName:"p"},"INyxx")," instance to alter caching behavior across the whole bot:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"/// Options for configuring cache. Allows to specify where and which entities should be cached and preserved in cache\nclass CacheOptions {\n  /// Defines in which locations members will be cached\n  CachePolicyLocation memberCachePolicyLocation = CachePolicyLocation();\n\n  /// Defines which members are preserved in cache\n  CachePolicy<IMember> memberCachePolicy = MemberCachePolicy.def;\n\n  /// Defines where channel entities are preserved cache. Defaults to [CachePolicyLocation] with additional objectConstructor set to true\n  CachePolicyLocation channelCachePolicyLocation = CachePolicyLocation()..objectConstructor = true;\n\n  /// Defines which channel entities are preserved in cache.\n  CachePolicy<IChannel> channelCachePolicy = ChannelCachePolicy.def;\n\n  /// Defines in which places user can be cached\n  CachePolicyLocation userCachePolicyLocation = CachePolicyLocation();\n\n  /// Defines in which locations members will be cached\n  CachePolicyLocation messageCachePolicyLocation = CachePolicyLocation();\n\n  /// Defines which members are preserved in cache\n  CachePolicy<IMessage> messageCachePolicy = MessageCachePolicy.def;\n}\n")),(0,o.kt)("p",null,"For now there are a few things you can do:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Alter when objects are added to cache (from websocket events or HTTPS requests);"),(0,o.kt)("li",{parentName:"ol"},"Control which objects are added to cache (by specifying a predicate to choose which objects to cache)")),(0,o.kt)("h4",{id:"cachepolicylocation"},"CachePolicyLocation"),(0,o.kt)("p",null,"This setting allows to specify when object are added to the cache:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"event"),": Objects are cached from websocket events;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"objectConstructor"),": Objects are cached from other object's constructors, for example ",(0,o.kt)("inlineCode",{parentName:"li"},"IMember")," objects from message payloads;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"http"),": Objects are added from HTTP API requests;"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"other"),": All other times an object could be cached.")),(0,o.kt)("p",null,"As an example, this code would only cache ",(0,o.kt)("inlineCode",{parentName:"p"},"IMember")," objects from websocket events and http API requests:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},'void main() {\n  final cacheOptions = CacheOptions()\n    ..memberCachePolicyLocation = (\n        CachePolicyLocation()\n          ..event = true\n          ..http = true\n    );\n\n  final bot = NyxxFactory.createNyxxWebsocket("token", 10, cacheOptions: cacheOptions);\n}\n')),(0,o.kt)("h4",{id:"cachepolicy"},"CachePolicy"),(0,o.kt)("p",null,"Another option to restrict caching is to specify a ",(0,o.kt)("inlineCode",{parentName:"p"},"CachePolicy")," which is a class that wraps a callback executed when trying to cache objects."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"CachePolicy")," can be freely composed with provided base methods or extended by the end developer:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},"/// Convenience method to concatenate other policy\nCachePolicy<T> or(CachePolicy<T> other);\n\n/// Convenience method to require other policy\nCachePolicy<T> and(CachePolicy<T> other);\n\n/// Composes a policy by concatenating multiple other policies from list\nstatic CachePolicy<S> any<S extends SnowflakeEntity>(List<CachePolicy<S>> policies);\n")),(0,o.kt)("p",null,"For example, this code would only cache ",(0,o.kt)("inlineCode",{parentName:"p"},"IMember")," objects who have roles:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-dart"},'void main() {\n  final cacheOptions = CacheOptions()\n    ..memberCachePolicy = CachePolicy<IMember>((member) => member.roles.isNotEmpty);\n\n  final bot = NyxxFactory.createNyxxWebsocket("token", 10, cacheOptions: cacheOptions);\n}\n')))}d.isMDXComponent=!0}}]);